name: Telegram Notifier
on:
  push:
  pull_request:
    types: [opened, closed, reopened]
  issues:
    types: [opened, closed, reopened]

jobs:
  notify-telegram:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram Notification
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # Formatea el mensaje segÃºn el evento
          case "${{ github.event_name }}" in
            "push")
              MESSAGE="ğŸ“Œ *Push en ${{ github.repository }}*
                      ğŸŒ¿ *Rama*: ${GITHUB_REF##*/}
                      ğŸ‘¤ *Autor*: ${{ github.actor }}
                      ğŸ“ *Commit*: \`$(echo "${{ github.event.head_commit.message }}" | cut -c1-50)\`
                      ğŸ”— [Ver cambios](${{ github.event.head_commit.url }})"
              ;;
            "pull_request")
              MESSAGE="ğŸ”€ *PR ${{ github.event.action }}*: ${{ github.event.pull_request.title }}
                      ğŸ‘¤ *Por*: ${{ github.actor }}
                      ğŸŒ¿ *Rama*: ${{ github.event.pull_request.head.ref }}
                      ğŸ”— [Ver PR](${{ github.event.pull_request.html_url }})"
              ;;
            "issues")
              MESSAGE="âš ï¸ *Issue ${{ github.event.action }}*: ${{ github.event.issue.title }}
                      ğŸ‘¤ *Por*: ${{ github.actor }}
                      ğŸ”— [Ver Issue](${{ github.event.issue.html_url }})"
              ;;
          esac

          # EnvÃ­a el mensaje a Telegram
          curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_TOKEN/sendMessage" \
            -d chat_id="$CHAT_ID" \
            -d text="$MESSAGE" \
            -d parse_mode="Markdown"